<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Manual installation</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PyKota Documentation"
HREF="index.html"><LINK
REL="UP"
TITLE="Installation"
HREF="c194.html"><LINK
REL="PREVIOUS"
TITLE="Installation"
HREF="c194.html"><LINK
REL="NEXT"
TITLE="PyKota's internals"
HREF="c735.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PyKota Documentation: A full featured Print Quota Solution for CUPS</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c194.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 2. Installation</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="c735.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN233"
>2.2. Manual installation</A
></H1
><P
>      To do a manual installation, we will see what has to be done on each of the servers we are planning to use.
      <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>          Of course, depending on the size of your network, you may very well
          use the same machine as both a Print Server and a database server.
          This is especially the case if you've got only one server.
        </P
></TD
></TR
></TABLE
></DIV
>  
    </P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN239"
>2.2.1. Database server installation</A
></H2
><P
>        Depending on <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s version number, different
        types of storage backends may be supported, so we will see for each one of
        them how to configure it.
      </P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN243"
>2.2.1.1. PostgreSQL</A
></H3
><P
>          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> is an <I
CLASS="FIRSTTERM"
>Object Relationnal DataBase
          Management System</I
> distributed under a <I
CLASS="FIRSTTERM"
>Free Software</I
>
          license from the 
          <A
HREF="http://www.postgresql.org"
TARGET="_top"
>http://www.postgresql.org</A
>
          web site. It certainely is the free <ACRONYM
CLASS="ACRONYM"
>RDBMS</ACRONYM
> which has the most advanced
          features, and is widely used all over the world.
        </P
><P
>          To configure your database, you must have PostgreSQL already working.
          The complete installation of <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> is not covered by
          the present manual, please refer to your system's documentation or to 
          <A
HREF="http://www.postgresql.org"
TARGET="_top"
>http://www.postgresql.org</A
> for
          details.
        </P
><P
>          One thing you have to check, though, is that every Print Server on which you
          want to install the print quota mechanism, must be able to connect to the
          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> server. In the default installation of
          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> this may not be the case for security reasons, except if both
          servers are in fact the same machine. In any case, it is recommended that you
          check the <TT
CLASS="FILENAME"
>/etc/postgresql/pg_hba.conf</TT
> file and modify it if
          needed. This file is self documented and its modification is straightforward.
          You also have to make sure that <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> accepts <ACRONYM
CLASS="ACRONYM"
>TCP/IP</ACRONYM
> connections.
          To do so you either have to launch it with the <CODE
CLASS="OPTION"
>-i</CODE
> option or
          modify the <TT
CLASS="FILENAME"
>/etc/postgresql/postgresql.conf</TT
> file, which is
          self documented and easy to modify too. Allowing <ACRONYM
CLASS="ACRONYM"
>TCP/IP</ACRONYM
> connections
          is not necessary though if your print quota database server and your Print Server are
          the very same host.
        </P
><P
>          Here's an excerpt from a <TT
CLASS="FILENAME"
>pg_hba.conf</TT
> file. This one rejects all
          connections to PyKota's database excepted when made from the same host by <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> users
          <TT
CLASS="LITERAL"
>pykotauser</TT
> or <TT
CLASS="LITERAL"
>pykotaadmin</TT
> with the correct password.
    <PRE
CLASS="SCREEN"
>        
          local all    postgres                              ident sameuser
          local all    all                                   reject
          host  pykota pykotauser  127.0.0.1 255.255.255.255 crypt
          host  pykota pykotaadmin 127.0.0.1 255.255.255.255 crypt
          host  pykota all         127.0.0.1 255.255.255.255 reject
    </PRE
>
       </P
><P
>          Of course if your print server and your database servers have different <ACRONYM
CLASS="ACRONYM"
>IP</ACRONYM
>
          addresses, you have to replace the <TT
CLASS="LITERAL"
>127.0.0.1</TT
> address above with your print
          server's <ACRONYM
CLASS="ACRONYM"
>IP</ACRONYM
> address. As an alternative, you could still keep these
          lines and add similar lines with other <ACRONYM
CLASS="ACRONYM"
>IP</ACRONYM
> addresses if you have several
          print servers for which you want a single centralized database.
          <DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Tip</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              Don't forget to restart <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> if you modify
              any of its configuration files, in order for the changes to take effect.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          Be careful, you may be unable to connect from a Print Server to the <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>
          server even if the configuration is correct. Sometimes your connections may be blocked by
          one or more network firewalls along the route from one machine to the other. If this
          is the case, then the best thing you can do is to ask your <I
CLASS="FIRSTTERM"
>Network Administrator</I
>
          to not filter the IP port used by <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>, which is
          usually port <TT
CLASS="LITERAL"
>5432/tcp</TT
>.
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              The TCP/IP network port used by PostgreSQL may be different. When in doubt, ask your 
              <I
CLASS="FIRSTTERM"
>System Administrator</I
> for the correct value. 
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          Now that your <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> server is up and running, and
          is waiting for your connections, you have to create the print quota database.
          To do so, you'll have to feed <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> with the
          <TT
CLASS="FILENAME"
>pykota-1.26_official/initscripts/postgresql/pykota-postgresql.sql</TT
> file.
          This file will create a print quota database administrator in the <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> system, then create an empty
          print quota database and set some permissions on it. The print quota database administrator
          is the <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>'s user used to manage the quota database.
          The print quota database Administrator is not present in the quota database
          itself, he is only defined in <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> and don't
          have to exist on any system, nor in the print quota database. His default name
          is <TT
CLASS="LITERAL"
>pykotaadmin</TT
>. 
          A print quota database read-only user is also created under the name of <TT
CLASS="LITERAL"
>pykotauser</TT
>.
          This read-only user is used by <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> to connect to the 
          print quota database when an user who is not a <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> administrator 
          <A
NAME="AEN298"
HREF="#FTN.AEN298"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
>
          launches a pykota command. This prevents normal
          users from being able to modify their own, or other users', quota information.
          The database which will be created will be named <TT
CLASS="LITERAL"
>pykota</TT
> by default.
          The <TT
CLASS="LITERAL"
>pykotaadmin</TT
> and <TT
CLASS="LITERAL"
>pykotauser</TT
> users by
          default respectively have <TT
CLASS="LITERAL"
>readwritepw</TT
> and <TT
CLASS="LITERAL"
>readonlypw</TT
>
          as their passwords.
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              You can choose other names and passwords if you want by modifying the 
              <TT
CLASS="FILENAME"
>initscripts/postgresql/pykota-postgresql.sql</TT
> file
              accordingly, and report your changes into <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s
              configuration files.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          To run this script, you can use the <B
CLASS="COMMAND"
>psql</B
> frontend to
          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>, but your priviledges must be sufficient
          to be allowed to create users and databases. You can launch <B
CLASS="COMMAND"
>psql</B
>
          as the <TT
CLASS="LITERAL"
>postgres</TT
> user which is <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>'s
          default administrator, and connect to the default database named <TT
CLASS="LITERAL"
>template1</TT
>.
          From a command line interpreter (i.e. shell), type the following commands :
          <PRE
CLASS="SCREEN"
>    jerome@nordine:~$ cd pykota-1.26_official/initscripts/postgresql
    jerome@nordine:~/pykota-1.26_official/initscripts$ psql -h localhost -U postgres template1
    Welcome to psql, the PostgreSQL interactive terminal.
    
    Type:  \copyright for distribution terms
         \h for help with SQL commands
         \? for help on internal slash commands
         \g or terminate with semicolon to execute query
         \q to quit
    
    template1=# \i pykota-postgresql.sql 
              ... a lot of output lines
    pykota=#       
          </PRE
>
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If you use RPM or DEB packages, usually the
              <TT
CLASS="FILENAME"
>pykota-postgresql.sql</TT
> file gets installed into the
              <TT
CLASS="FILENAME"
>/usr/share/pykota/postgresql</TT
> directory, along 
              with a README file.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          If you want to you can change passwords later in
          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> for the 
          <TT
CLASS="LITERAL"
>pykotaadmin</TT
> and <TT
CLASS="LITERAL"
>pykotauser</TT
> users.
          To do so, just type the following lines while still being at the <B
CLASS="COMMAND"
>psql</B
>
          prompt (replace the password values by your own :
          <PRE
CLASS="SCREEN"
>    pykota=# ALTER USER pykotaadmin PASSWORD 'somepassword';
    ALTER USER
    pykota=# ALTER USER pykotauser PASSWORD 'anotherpassword';
    pykota=# \q
    jerome@nordine:~/pykota-1.26_official/initscripts/postgresql$
          </PRE
>
        </P
><P
>          The <TT
CLASS="LITERAL"
>\q</TT
> command above will quit the <B
CLASS="COMMAND"
>psql</B
>
          program and return you to the shell's command line prompt.
        </P
><P
>          To improve security further, you could encrypt your database connections, or
          take any other step as needed. Please refer to <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>'s
          documentation for details. 
          <DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Warning</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              Defining passwords may not be sufficient if your database access rule is
              set to <TT
CLASS="LITERAL"
>trust</TT
> in the <TT
CLASS="FILENAME"
>/etc/postgresql/pg_hba.conf</TT
>.
              Again, please refer to <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>'s documentation
              for details. Also, passwords will fly unencrypted over the network by default,
              so be sure to take any necessary step to secure your database server from
              unauthorized use. This has nothing to do with <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>
              though, it is just a general rule to keep in mind.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          For more details, please see <TT
CLASS="FILENAME"
>initscripts/mysql/README.postgresql</TT
>.
        </P
><P
>          If no error occured, then your print quota database is ready to be used.
          Now you can let the print quota database server alone, the remaining work
          will have to be done on each one of the print servers which will
          use this particular print quota database server.
          <DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Tip</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If an error occured, maybe your PostgreSQL version is too old, or
              an unexpected problem (like a bug) happened. Please contact us via email so that we
              can try to fix the problem. Thanks in advance.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN349"
>2.2.1.2. LDAP</A
></H3
><P
>          Any <ACRONYM
CLASS="ACRONYM"
>LDAP</ACRONYM
> server, and particularly <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
>, can be used 
          as a print quota database backend.
          Some other LDAP servers can be used, but this is currently untested in production.
        </P
><P
>          <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
> is a Lightweight Directory Access Protocol server
          implementation published as Free Software.
          You can download it from <A
HREF="http://www.openldap.org"
TARGET="_top"
>http://www.openldap.org</A
>.
        </P
><P
>          To use <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
> as your print quota database backend, you have to copy the
          <TT
CLASS="FILENAME"
>pykota/initscripts/ldap/pykota.schema</TT
> into <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
>'s 
          schemas directory.
          Under Debian GNU/Linux, this is something like :
          <PRE
CLASS="SCREEN"
>        
    $ cp pykota.schema /etc/ldap/schema
          </PRE
>
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If you use RPM or DEB packages, the
              <TT
CLASS="FILENAME"
>pykota.schema</TT
> file is usually installed into the
              <TT
CLASS="FILENAME"
>/usr/share/pykota/ldap</TT
> directory, along
              with a README file, and may also be installed automatically in
              your <ACRONYM
CLASS="ACRONYM"
>LDAP</ACRONYM
> server's schemas directory.
            </P
></TD
></TR
></TABLE
></DIV
>  
       </P
><P
>   
         Then edit <TT
CLASS="FILENAME"
>/etc/ldap/slapd.conf</TT
> and add a line to    
         include the PyKota schema. You should have something
         like :
         <PRE
CLASS="SCREEN"
>    
    # Schema and objectClass definitions
    include         /etc/ldap/schema/core.schema
    include         /etc/ldap/schema/cosine.schema
    include         /etc/ldap/schema/nis.schema
    include         /etc/ldap/schema/inetorgperson.schema
    include         /etc/ldap/schema/pykota.schema
          </PRE
>        
        </P
><P
>          While this is not mandatory, it is recommended that you setup
          some indexes for some often accessed PyKota attributes.
          Here are the minimal indexes
          lines you may want to put in <TT
CLASS="FILENAME"
>slapd.conf</TT
> :
          <PRE
CLASS="SCREEN"
>    # Indexes for PyKota
    index pykotaUserName pres,eq,sub
    index pykotaGroupName pres,eq,sub
    index pykotaPrinterName pres,eq,sub
    index pykotaBillingCode pres,eq,sub
    index pykotaLastJobIdent eq
          </PRE
>
        </P
><P
>          Now you must ensure that the DNs you'll use to bind to    
          your OpenLDAP server don't have search queries size limits,
          which gives for example (OpenLDAP 2.1.x or above) :
          
    <PRE
CLASS="SCREEN"
>        
    # No Limits for PyKota's administrator and read-only user
    limits dn="cn=pykotaadmin,dc=example,dc=com" size.soft=-1 size.hard=soft
    limits dn="cn=pykotauser,dc=example,dc=com" size.soft=-1 size.hard=soft
    </PRE
>        
    
          Where pykotaadmin and pykotauser are the usernames used to bind to your
          OpenLDAP server within PyKota, respectively in ReadWrite mode 
          (as set in pykotadmin.conf) and in ReadOnly mode (as set in pykota.conf).
        </P
><P
>          Finally, stop the <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
> server, generate
          the index files, and restart <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
>
          <PRE
CLASS="SCREEN"
>    
    $ /etc/init.d/slapd stop
    $ slapindex
    $ /etc/init.d/slapd start
          </PRE
>
        </P
><P
>          With an <ACRONYM
CLASS="ACRONYM"
>LDAP</ACRONYM
> backend, PyKota will need some branches
          in your <ACRONYM
CLASS="ACRONYM"
>LDAP</ACRONYM
> directory to put its own datas.
          You can configure PyKota to either attach its datas to your existing
          users and groups, or to put them in their own <TT
CLASS="LITERAL"
>ou</TT
>.
          But some <TT
CLASS="LITERAL"
>ou</TT
>s dedicated to PyKota are needed in any case,
          so the best bet may be to put all PyKota's datas below an <TT
CLASS="LITERAL"
>ou=PyKota</TT
>
          branch. While this will separate these datas from your existing users and groups
          entries, this may ease the maintainance.
        </P
><P
>          PyKota needs at least an <TT
CLASS="LITERAL"
>ou</TT
> for printers, for users quotas, for
          groups quotas, for print jobs, for billing codes, and for pointers to the last job of each printer.
          In the future, this last <TT
CLASS="LITERAL"
>ou</TT
> may disappear as its content
          will probably be attached to each printer.
        </P
><P
>          Actually PyKota doesn't create these <TT
CLASS="LITERAL"
>ou</TT
>s for you, because it's
          difficult to guess what is the best configuration for you. So you have to
          create them by yourself, either directly with a text editor and the
          <B
CLASS="COMMAND"
>ldapadd</B
> command, or with some specialized tool
          like <B
CLASS="COMMAND"
>gq</B
>. You can look at the <TT
CLASS="FILENAME"
>initscripts/ldap/pykota-sample.ldif</TT
>
          file to see which minimal branches are necessary.
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If you use RPM or DEB packages, usually the
              <TT
CLASS="FILENAME"
>pykota-sample.ldif</TT
> file is installed into the
              <TT
CLASS="FILENAME"
>/usr/share/pykota/ldap</TT
> directory, along 
              with a README file.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          If no error occured, then your print quota database is ready to be used.
          Now you can let the print quota database server alone, the remaining work
          will have to be done on each one of the print servers which will
          use this particular print quota database server.
          <DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Tip</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If an error occured, maybe your OpenLDAP version is too old, or
              an unexpected problem (like a bug) happened. Please contact us via email so that we
              can try to fix the problem. Thanks in advance.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN403"
>2.2.1.3. MySQL</A
></H3
><P
>          <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> is a simple Relationnal DataBase
          Management System distributed under a <I
CLASS="FIRSTTERM"
>Free Software</I
>
          license from the 
          <A
HREF="http://www.mysql.org"
TARGET="_top"
>http://www.mysql.org</A
>
          web site. 
        </P
><P
>          To configure your database, you must have MySQL version 4.1 or higher already working.
          We recommend that you use MySQL 5.0 or higher though.
          The complete installation of <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> is not covered by
          the present manual, please refer to your system's documentation or to 
          <A
HREF="http://www.mysql.org"
TARGET="_top"
>http://www.mysql.org</A
> for
          details.
        </P
><P
>          One thing you have to check, though, is that every Print Server on which you
          want to install the print quota mechanism, must be able to connect to the
          <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> server. In the default installation of
          <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> this may not be the case for security reasons, except if both
          servers are in fact the same machine. In any case, it is recommended that you
          check the <TT
CLASS="FILENAME"
>/etc/mysql/my.cnf</TT
> file and modify it if
          needed.
          <DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Tip</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              Don't forget to restart <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> if you modify
              any of its configuration files, in order for the changes to take effect.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          Be careful, you may be unable to connect from a Print Server to the <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
>
          server even if the configuration is correct. Sometimes your connections may be blocked by
          one or more network firewalls along the route from one machine to the other. If this
          is the case, then the best thing you can do is to ask your <I
CLASS="FIRSTTERM"
>Network Administrator</I
>
          to not filter the IP port used by <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
>, which is
          usually port <TT
CLASS="LITERAL"
>3306/tcp</TT
>.
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              The TCP/IP network port used by MySQL may be different. When in doubt, ask your 
              <I
CLASS="FIRSTTERM"
>System Administrator</I
> for the correct value. 
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          Now that your <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> server is up and running, and
          is waiting for your connections, you have to create the print quota database.
          To do so, you'll have to feed <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> with the
          <TT
CLASS="FILENAME"
>pykota-1.26_official/initscripts/mysql/pykota-mysql.sql</TT
> file.
          This file will create an empty
          print quota database and set some permissions on it. 
          The database which will be created will be named <TT
CLASS="LITERAL"
>pykota</TT
> by default.
          Two database users will be defined to have access in readonly and read+write modes under
          the respective names <TT
CLASS="LITERAL"
>pykotauser</TT
> and <TT
CLASS="LITERAL"
>pykotaadmin</TT
>.
          The <TT
CLASS="LITERAL"
>pykotaadmin</TT
> and <TT
CLASS="LITERAL"
>pykotauser</TT
> users by
          default respectively have <TT
CLASS="LITERAL"
>readwritepw</TT
> and <TT
CLASS="LITERAL"
>readonlypw</TT
>
          as their passwords.
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              You can choose other names and passwords if you want by modifying the 
              <TT
CLASS="FILENAME"
>initscripts/mysql/pykota-mysql.sql</TT
> file
              accordingly, and report your changes into <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s
              configuration files.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          To run this script, you can use the <B
CLASS="COMMAND"
>mysql</B
> frontend to
          <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
>, but your priviledges must be sufficient
          to be allowed to create databases. You can launch <B
CLASS="COMMAND"
>mysql</B
>
          as the <TT
CLASS="LITERAL"
>root</TT
> user for example.
          From a command line interpreter (i.e. shell), type the following commands :
          <PRE
CLASS="SCREEN"
>    jerome@nordine:~$ cd pykota-1.26_official/initscripts/mysql
    jerome@nordine:~/pykota-1.26_official/initscripts$ mysql &#60;pykota-mysql.sql
          </PRE
>
          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Note</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If you use RPM or DEB packages, usually the
              <TT
CLASS="FILENAME"
>pykota-mysql.sql</TT
> file gets installed into the
              <TT
CLASS="FILENAME"
>/usr/share/pykota/mysql</TT
> directory, along 
              with a README file.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
><P
>          To improve security further, you could encrypt your database connections, or
          take any other step as needed. Please refer to <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
>'s
          documentation for details. 
        </P
><P
>          For more details, please see <TT
CLASS="FILENAME"
>initscripts/mysql/README.mysql</TT
>.
        </P
><P
>          If no error occured, then your print quota database is ready to be used.
          Now you can let the print quota database server alone, the remaining work
          will have to be done on each one of the print servers which will
          use this particular print quota database server.
          <DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Tip</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If an error occured, maybe your MySQL version is too old, or
              an unexpected problem (like a bug) happened. Please contact us via email so that we
              can try to fix the problem. Thanks in advance.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN464"
>2.2.1.4. SQLite</A
></H3
><P
>          <SPAN
CLASS="APPLICATION"
>SQLite</SPAN
> is an embeddable Relationnal DataBase
          distributed under a Free Software
          license from the 
          <A
HREF="http://www.sqlite.org"
TARGET="_top"
>http://www.sqlite.org</A
>
          web site. 
          If is very easy to configure and use, offers a very small memory footprint,
          is very fast, but can only be used on the print server because it doesn't include
          a server daemon : the database is directly embedded in the application.
        </P
><P
>          To configure your database, you must have SQLite already working.
          The complete installation of <SPAN
CLASS="APPLICATION"
>SQLite</SPAN
> is not covered by
          the present manual, please refer to your system's documentation or to 
          <A
HREF="http://www.sqlite.org"
TARGET="_top"
>http://www.sqlite.org</A
> for
          details.
        </P
><P
>          Once <SPAN
CLASS="APPLICATION"
>SQLite</SPAN
> is installed, you have to decide where
          you'll put your database. A good idea is to store it into the <TT
CLASS="LITERAL"
>pykota</TT
>
          user's home directory. Then to create the database, just type :
    <PRE
CLASS="SCREEN"
>        
    # sqlite3 ~pykota/pykota.db &#60;pykota/initscripts/sqlite/pykota.sqlite
    # chown pykota.pykota ~pykota/pykota.db
    # chmod 660 ~pykota/pykota.db
    # chown pykota.pykota ~pykota
    </PRE
>
        </P
><P
>          If user <TT
CLASS="LITERAL"
>pykota</TT
> doesn't exist yet, then please
          follow the instructions a bit below which explain how to install PyKota on the print server.
        </P
><P
>          Once this is done, you'll want to set in <TT
CLASS="FILENAME"
>~pykota/pykota.conf</TT
> the
          following lines in the <TT
CLASS="LITERAL"
>[global]</TT
> section :
    <PRE
CLASS="SCREEN"
>        
    storagebackend : sqlitestorage
    storagename : /etc/pykota/pykota.db
    </PRE
>
        </P
><P
>          Of course you'll want to replace the path on the <TT
CLASS="LITERAL"
>storagename</TT
> line
          with the full path to the newly created <SPAN
CLASS="APPLICATION"
>SQLite</SPAN
> database.
        </P
><P
>          If no error occured, then your print quota database is ready to be used.
          In case you need them, additional instructions are available in <TT
CLASS="FILENAME"
>pykota/initscripts/sqlite/README.sqlite</TT
>
          <DIV
CLASS="TIP"
><P
></P
><TABLE
CLASS="TIP"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Tip</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>              If an error occured, maybe your SQLite version is too old, or
              an unexpected problem (like a bug) happened. Please contact us via email so that we
              can try to fix the problem. Thanks in advance.
            </P
></TD
></TR
></TABLE
></DIV
>  
        </P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN490"
>2.2.1.5. Berkeley DB</A
></H3
><P
>          A <SPAN
CLASS="APPLICATION"
>Berkeley DB</SPAN
> backend is planned, but it actually
          doesn't exist. It seems that remote storage won't be possible with such a backend,
          so in other terms this means that you will have a different quota database on
          each print server. This may still prove to be useful for small configurations.
        </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN494"
>2.2.2. Print Server Installation</A
></H2
><P
>        For each Print Server on which you plan to implement the print quota
        mechanism, you have, of course, to have an already working printing environment. 
        Currently <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> works with 
        <A
HREF="http://www.cups.org"
TARGET="_top"
><SPAN
CLASS="APPLICATION"
>CUPS</SPAN
></A
>
        but older releases also supported <A
HREF="http://lprng.sourceforge.net"
TARGET="_top"
><SPAN
CLASS="APPLICATION"
>LPRng</SPAN
></A
>.
        <SPAN
CLASS="APPLICATION"
>LPRng</SPAN
> support might be re-added in the future.
      </P
><P
>        Here's the list of software you have to install on each Print Server, version numbers
        are given as an indication of which was successfully tested, but older versions may 
        work too.
        <P
></P
><UL
><LI
><P
>              <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
> version 1.1.14 or higher, version 1.2.4 or higher
              is recommanded.
              You can download it from <A
HREF="http://www.cups.org"
TARGET="_top"
>http://www.cups.org</A
>
            </P
></LI
><LI
><P
>              <SPAN
CLASS="APPLICATION"
>Python</SPAN
> version 2.3 or higher.
              You can download it from <A
HREF="http://www.python.org"
TARGET="_top"
>http://www.python.org</A
>.
              While <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> itself will try to preserve compatibility
              with <SPAN
CLASS="APPLICATION"
>Python</SPAN
> version 2.3 for the near future, some <SPAN
CLASS="APPLICATION"
>Python</SPAN
>
              modules which are needed by <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> may require a more recent version
              of this language.
            </P
></LI
><LI
><P
>              print quota database client libraries, depending on your print quota database backend :
              <P
></P
><UL
><LI
><P
>                    PostgreSQL backend :
                    <P
></P
><UL
><LI
><P
>                          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
> client libraries. They must match the <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>
                          version used on your print quota database server.
                        </P
></LI
><LI
><P
>                          The <SPAN
CLASS="APPLICATION"
>PygreSQL</SPAN
> python module. 
                          <SPAN
CLASS="APPLICATION"
>PygreSQL</SPAN
> is normally included in
                          <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>, but you may want to
                          download it from <A
HREF="http://www.pygresql.org"
TARGET="_top"
>http://www.pygresql.org</A
>
                        </P
></LI
></UL
>  
                  </P
></LI
><LI
><P
>                    OpenLDAP backend : 
                    <P
></P
><UL
><LI
><P
>                          <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
> client libraries. They must match
                          the <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
> version used on your print quota database server.
                        </P
></LI
><LI
><P
>                          The <SPAN
CLASS="APPLICATION"
>Python-LDAP</SPAN
> python module.
                          You may download this module from <A
HREF="http://python-ldap.sourceforge.net"
TARGET="_top"
>http://python-ldap.sourceforge.net</A
>
                        </P
></LI
></UL
>
                  </P
></LI
><LI
><P
>                    MySQL backend :
                    <P
></P
><UL
><LI
><P
>                          <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> client libraries. They must match the <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
>
                          version used on your database server.
                        </P
></LI
><LI
><P
>                          The <SPAN
CLASS="APPLICATION"
>Python-MySQL</SPAN
> python module, version 1.2.x or higher. 
                          You can download it from <A
HREF="http://sourceforge.net/projects/mysql-python"
TARGET="_top"
>http://sourceforge.net/projects/mysql-python</A
>
                        </P
></LI
></UL
>  
                  </P
></LI
><LI
><P
>                    SQLite backend : SQLite is not a database server, but an embeddable database, so
                    if you want to use it you MUST install SQLite on your print server. With 
                    <SPAN
CLASS="APPLICATION"
>PostgreSQL</SPAN
>, <SPAN
CLASS="APPLICATION"
>MySQL</SPAN
> or
                    <SPAN
CLASS="APPLICATION"
>OpenLDAP</SPAN
> you can store your datas on a different
                    machine than the print server, but this is not possible with <SPAN
CLASS="APPLICATION"
>SQLite</SPAN
>.
                    <P
></P
><UL
><LI
><P
>                          <SPAN
CLASS="APPLICATION"
>SQLite</SPAN
> version 3.2.1 or higher and its library.
                          You can download it from 
                          <A
HREF="http://www.sqlite.org"
TARGET="_top"
>http://www.sqlite.org</A
>
                        </P
></LI
><LI
><P
>                          The <SPAN
CLASS="APPLICATION"
>Python-SQLite</SPAN
> python module version 2.0.5 or higher.
                          You can download it from 
                          <A
HREF="http://www.pysqlite.org"
TARGET="_top"
>http://www.pysqlite.org</A
>
                        </P
></LI
></UL
>
                  </P
></LI
><LI
><P
>                    Berkeley DB backend : Not supported yet.
                  </P
></LI
></UL
>  
            </P
></LI
><LI
><P
>              <SPAN
CLASS="APPLICATION"
>ucd-snmp</SPAN
> or <SPAN
CLASS="APPLICATION"
>net-snmp</SPAN
> tools, version 4.2.5 or above. You only need
              the <B
CLASS="COMMAND"
>snmpget</B
> command.
              You can download this software from <A
HREF="http://www.sourceforge.net/projects/net-snmp/"
TARGET="_top"
>http://www.sourceforge.net/projects/net-snmp/</A
>.
              You only need this if PyKota's internal SNMP accounting code doesn't work for your SNMP-aware
              printers.
            </P
></LI
><LI
><P
>              <SPAN
CLASS="APPLICATION"
>netatalk</SPAN
> version 1.6.1 or above. You only need
              the <B
CLASS="COMMAND"
>pap</B
> command.
              You can download this software from <A
HREF="http://netatalk.sourceforge.net/"
TARGET="_top"
>http://netatalk.sourceforge.net/</A
>.
              You only need this if you plan to query your printers for their internal page counter via AppleTalk.
            </P
></LI
><LI
><P
>              eGenix' mxDateTime Python module version 2.0.3 or above. It must match your default Python version.
              You can download it from <A
HREF="http://www.egenix.com"
TARGET="_top"
>http://www.egenix.com</A
>.
            </P
></LI
><LI
><P
>              The Python acccelerator <SPAN
CLASS="APPLICATION"
>Psyco</SPAN
>. It must match your default Python version.
              You can download it from <A
HREF="http://psyco.sourceforge.net"
TARGET="_top"
>http://psyco.sourceforge.net</A
>.
              You only need this if you run on the <TT
CLASS="LITERAL"
>x86</TT
> architecture because 
              <SPAN
CLASS="APPLICATION"
>Psyco</SPAN
> doesn't yet exist on other architectures.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>pysnmp</SPAN
> Python module version 3.4.2, or higher, version 4 is recommanded.
              You can download it from <A
HREF="http://pysnmp.sourceforge.net"
TARGET="_top"
>http://pysnmp.sourceforge.net</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>JAXML</SPAN
> Python module. 
              You can download it from <A
HREF="http://www.librelogiciel.com/software/"
TARGET="_top"
>http://www.librelogiciel.com/software/</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>ReportLab</SPAN
> Toolkit Python module. 
              You can download it from <A
HREF="http://www.reportlab.org"
TARGET="_top"
>http://www.reportlab.org</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>Python Imaging Library - PIL</SPAN
> module. 
              You can download it from <A
HREF="http://www.pythonware.com"
TARGET="_top"
>http://www.pythonware.com</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>PyOSD</SPAN
> Python module. 
              You can download it from <A
HREF="http://repose.cx/pyosd/"
TARGET="_top"
>http://repose.cx/pyosd/</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>pkpgcounter</SPAN
> Generic Page Description Language parser. 
              You can download it from <A
HREF="http://www.pykota.com.com/software/pkpgcounter"
TARGET="_top"
>http://www.pykota.com/software/pkpgcounter</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>PyPAM</SPAN
> Python interface to <ACRONYM
CLASS="ACRONYM"
>PAM</ACRONYM
>.
              You'll need this if you plan to ask users to authenticate when printing through <B
CLASS="COMMAND"
>pknotify</B
>
              and <B
CLASS="COMMAND"
>pykoticon</B
>. You don't need this module otherwise.
              If needed, you can download it from <A
HREF="http://www.pangalactic.org/PyPAM/"
TARGET="_top"
>http://www.pangalactic.org/PyPAM/</A
>.
            </P
></LI
><LI
><P
>              The <SPAN
CLASS="APPLICATION"
>PkIPPLib</SPAN
> Python <ACRONYM
CLASS="ACRONYM"
>IPP</ACRONYM
> library.
              You can download it from <A
HREF="http://www.pykota.com/software/pkipplib"
TARGET="_top"
>http://www.pykota.com/software/pkipplib</A
>.
            </P
></LI
></UL
>  
      </P
><P
>        Instead of downloading all these programs' sources and compiling them, which really
        is a boring task considering that many software are needed, you may prefer to look
        into the packages included with your GNU/Linux distribution of choice (if you use
        this operating system of course). Most, if not all, GNU/Linux distributions include
        all the software mentionned above, in the form of packages which are easier to
        install than sources tarballs. This is probably the same for the many *BSD
        distributions.
      </P
><P
>         You can check that all needed software is installed by launching the <B
CLASS="COMMAND"
>checkdeps.py</B
>
         command :
        <PRE
CLASS="SCREEN"
>      
    $ python checkdeps.py      
        </PRE
>
      </P
><P
>        Once all these software are installed, installing PyKota itself is a breeze.
        PyKota being written entirely in the Python language, which is interpreted, 
        there's no need to compile anything. You just have to execute the installation
        script :
        <PRE
CLASS="SCREEN"
>      
    $ python setup.py install      
        </PRE
>
      </P
><P
>        The setup script will automatically create the 
        <TT
CLASS="FILENAME"
>/usr/share/pykota/conf</TT
> directory and put the sample 
        configuration files <TT
CLASS="FILENAME"
>conf/pykota.conf.sample</TT
> and
        <TT
CLASS="FILENAME"
>conf/pykotadmin.conf.sample</TT
> there, along with
        a <TT
CLASS="FILENAME"
>README</TT
> file explaining their purpose.
      </P
><P
>        Now you have to create a <TT
CLASS="LITERAL"
>pykota</TT
> system user and group. The <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>
        software will automatically search its configuration files in user <TT
CLASS="LITERAL"
>pykota</TT
>'s
        home directory. For example we could create the user and group, and set <TT
CLASS="FILENAME"
>/etc/pykota</TT
>
        as the home directory, but any other home directory will do :
    <PRE
CLASS="SCREEN"
>      
      adduser --system --group --home /etc/pykota --gecos PyKota pykota
    </PRE
>
      </P
><P
>        You now have to copy the sample configuration files into the <TT
CLASS="FILENAME"
>~pykota</TT
>
        directory, under the respective names <TT
CLASS="FILENAME"
>pykota.conf</TT
> and 
        <TT
CLASS="FILENAME"
>pykotadmin.conf</TT
>. Once copied there, you just
        have to modify these files to adapt them to your own setup.
        These files are heavily commented, so you should have no problem.
        Also their format is quite common, because it's the one used by
        <SPAN
CLASS="APPLICATION"
>Samba</SPAN
> for example, or by <TT
CLASS="LITERAL"
>.ini</TT
>
        files under <SPAN
CLASS="APPLICATION"
>MS-Windows</SPAN
>, so you may already
        be familiar with this syntax.
        In a future release, this documentation will include the complete
        reference for all configuration fields available. Keep in mind that
        <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> can be really heavily customized, and can delegate some work
        to any external command of your choice.
      </P
><P
>        Please create a backup copy of the <TT
CLASS="FILENAME"
>~pykota</TT
>
        directory before modifying a working installation.
      </P
><P
>        PyKota features some interesting possibilities which allow you to
        define options either globally so that they apply to all printers,
        or on a per printer basis. Please see the sample configuration files
        to see what I mean. In the simplest form, only a <TT
CLASS="LITERAL"
>[global]</TT
> section is
        needed. In more complex configurations, you will have to create 
        one section per printer. Each section in the configuration files
        begins with a name between square brackets <TT
CLASS="LITERAL"
>[]</TT
>.
        The name to use to define a particular printer section is the name
        of the print queue you want to manage with PyKota.
      </P
><P
>        After you have modified <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s configuration files, you have to
        double check their permissions, otherwise your installation may be
        insecure or may not work at all.
        The main configuration file <TT
CLASS="FILENAME"
>~pykota/pykota.conf</TT
>
        doesn't contain much sensitive information, so it can be made
        readable by anyone. If normal users read this file, at best they
        will learn the username and optional password of the read-only
        database user. This means that beside being allowed to read all the contents of
        the quota database, they won't be allowed to modify or delete it.
        On the other hand, the <TT
CLASS="FILENAME"
>~pykota/pykotadmin.conf</TT
>
        file contains the read-write user's identity and password. You must then
        ensure that no normal user can read this file. It should only be readable
        by the <TT
CLASS="LITERAL"
>root</TT
> user, which is always the case, and by 
        <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> administrators. In addition,
        users for which <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
> doesn't run as user <TT
CLASS="LITERAL"
>root</TT
> will 
        have to ensure that the user their printing system is run as
        can read both of these files. An easy way to do so is to put the <TT
CLASS="LITERAL"
>lp</TT
> user
        (for example) into the <TT
CLASS="LITERAL"
>pykota</TT
> system group, then
        to give the correct permissions to <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s configuration files :
        <PRE
CLASS="SCREEN"
>    $ chown -R pykota.pykota ~pykota/      
    $ chmod 750 ~pykota/
    $ chmod 644 ~pykota/pykota.conf      
    $ chmod 640 ~pykota/pykotadmin.conf      
        </PRE
>
        
        <DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/warning.gif"
HSPACE="5"
ALT="Warning"></TD
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><B
>Warning</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>            All the users allowed to read the <TT
CLASS="FILENAME"
>~pykota/pykotadmin.conf</TT
> 
            are considered to be <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> administrators. So be
            careful with these files permissions.
          </P
></TD
></TR
></TABLE
></DIV
>
      </P
><P
>        On some systems, you may be able to strenghten permissions like this :
        <PRE
CLASS="SCREEN"
>    $ chown -R pykota.pykota ~pykota/      
    $ chmod 750 ~pykota/
    $ chmod 640 ~pykota/pykota.conf      
    $ chmod 600 ~pykota/pykotadmin.conf      
        </PRE
>
      </P
><P
>        And on other ones, you may need to relax them, and change the files' owner :
        <PRE
CLASS="SCREEN"
>    $ chown pykota.pykota ~pykota/      
    $ chmod 755 ~pykota/
    $ chown lp.pykota ~pykota/pykota.conf      
    $ chmod 640 ~pykota/pykota.conf      
    $ chown lp.pykota ~pykota/pykotadmin.conf      
    $ chmod 640 ~pykota/pykotadmin.conf      
        </PRE
>
      </P
><P
>        This all depends on the printing system you are using, and the user the
        printing system is usually running as. You need to remember three things :
        
        <P
></P
><UL
><LI
><P
>              The user your printing system runs as MUST be allowed to read
              both <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s configuration files.
            </P
></LI
><LI
><P
>              Any user who can read <TT
CLASS="FILENAME"
>pykotadmin.conf</TT
>
              is a <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> administrator, and
              can do whatever he wants to the print quota database.
            </P
></LI
><LI
><P
>              If <TT
CLASS="FILENAME"
>cupsd.conf</TT
> contains <TT
CLASS="LITERAL"
>RunAsUser</TT
>, then
              you won't be able to authenticate users with <B
CLASS="COMMAND"
>pknotify</B
> and <B
CLASS="COMMAND"
>pykoticon</B
>.
              Also in this case you may have to make <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
>'s configuration files
              owned by the user <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
> runs as.
            </P
></LI
></UL
>  
      </P
><P
>        Don't forget to restart your print server sofware if you changed group membership for the user it runs
        as, otherwise your change wouldn't be taken into account.
      </P
><P
>        Now depending on your printing system, the configuration to do is particular.
        We will now see how to plug PyKota into <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
> since <SPAN
CLASS="APPLICATION"
>LPRng</SPAN
>
        is not supported anymore.
      </P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="AEN700"
>2.2.2.1. With CUPS</A
></H3
><P
>          From version 1.16alpha7 on, configuring <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> to integrate
          within <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
> is more than easy.
        </P
><P
>          You just have to create a symbolic link to the <B
CLASS="COMMAND"
>cupspykota</B
>
          command in <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
>' backend directory :
          <PRE
CLASS="SCREEN"
>        
    $ cd /usr/lib/cups/backend        
    $ ln -s /usr/share/pykota/cupspykota cupspykota
          </PRE
>
        </P
><P
>          If you use CUPS v1.2 or higher, you must
          also type the following command to allow the <B
CLASS="COMMAND"
>cupspykota</B
>
          backend to correctly support other backends which must be run
          as the root user (e.g. the <B
CLASS="COMMAND"
>lpd</B
> backend) :
          <PRE
CLASS="SCREEN"
>        
    $ chmod 700 /usr/share/pykota/cupspykota
          </PRE
>
        </P
><P
>          You have to restart <SPAN
CLASS="APPLICATION"
>CUPS</SPAN
> for this modification to
          take effect : 
          <PRE
CLASS="SCREEN"
>    $ /etc/init.d/cupsys restart        
          </PRE
>
        </P
><P
>          Now point your web browser to CUPS configuration page, usually at 
          <A
HREF="http://localhost:631"
TARGET="_top"
>http://localhost:631</A
> on
          your print server.
        </P
><P
>          Then when creating new printers or reconfiguring existing ones, just
          choose devices which are <TT
CLASS="LITERAL"
>PyKota managed</TT
>
          <A
NAME="AEN720"
HREF="#FTN.AEN720"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
>
          instead of
          normal devices. You've got one <TT
CLASS="LITERAL"
>PyKota managed</TT
> device
          for each regular device available from CUPS, so just choose the appropriate
          one.
        </P
><P
>          Repeat the above procedure for each print queue on which you want to use
          PyKota. That's all !
        </P
><DIV
CLASS="SECT4"
><H4
CLASS="SECT4"
><A
NAME="AEN727"
>2.2.2.1.1. Troubleshooting</A
></H4
><P
>            In case of problem, the simplest way to solve it is currently
            to ask on PyKota's mailing list, describing the symptoms, as
            well as the hardware and software you use.
          </P
><P
>            A searchable FAQ is now available at 
            <A
HREF="http://otrs.librelogiciel.com/otrs/public.pl"
TARGET="_top"
>http://otrs.librelogiciel.com/public.pl</A
>.
            A FAQ entry explaining in great details how to diagnose a problem correctly is
            available at 
            <A
HREF="http://otrs.librelogiciel.com/otrs/public.pl?ID=2"
TARGET="_top"
>http://otrs.librelogiciel.com/public.pl?ID=2</A
>.
          </P
><P
>            You can also ask questions on IRC :
            <PRE
CLASS="SCREEN"
>    /server irc.freenode.net          
    /join #pykota
            </PRE
>
          </P
></DIV
></DIV
></DIV
></DIV
><H3
CLASS="FOOTNOTES"
>Notes</H3
><TABLE
BORDER="0"
CLASS="FOOTNOTES"
WIDTH="100%"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN298"
HREF="x233.html#AEN298"
><SPAN
CLASS="footnote"
>[1]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>a <SPAN
CLASS="APPLICATION"
>PyKota</SPAN
> administrator is an user who can read the <TT
CLASS="FILENAME"
>~pykota/pykotadmin.conf</TT
> file.</P
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="5%"
><A
NAME="FTN.AEN720"
HREF="x233.html#AEN720"
><SPAN
CLASS="footnote"
>[2]</SPAN
></A
></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="95%"
><P
>              Debian 3.0 Woody is known to have problems : CUPS 1.1.14 doesn't automatically
              detect <TT
CLASS="LITERAL"
>PyKota managed</TT
> devices. So you have to manually
              modify CUPS' <TT
CLASS="FILENAME"
>printers.conf</TT
> file as explained in 
              PyKota's toplevel <TT
CLASS="FILENAME"
>README</TT
> file.
            </P
></TD
></TR
></TABLE
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c194.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="c735.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Installation</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c194.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>PyKota's internals</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>